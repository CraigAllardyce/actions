name: 'Setup Authentication'
description: 'Configure access to code'
runs:
  using: "composite"
  steps:    
    - name: Setup Authentication
      shell: bash
      run: |
        'command -v ssh-agent >/dev/null || ( apt-get update -y && apt-get install openssh-client -y )'
        eval $(ssh-agent -s)
        echo "$SSH_PRIVATE_KEY" | base64 -d | tr -d '\r' | ssh-add -
        mkdir -p ~/.ssh
        chmod 700 ~/.ssh
        echo "$SSH_KNOWN_HOSTS" >> ~/.ssh/known_hosts
        chmod 644 ~/.ssh/known_hosts
        touch ~/.npmrc
        echo tag-version-prefix= >> ~/.npmrc
        echo @focus:registry=https://artifactory.dimensiondata.com/artifactory/api/npm/npm/ >> ~/.npmrc
        echo @insight:registry=https://artifactory.dimensiondata.com/artifactory/api/npm/npm/ >> ~/.npmrc
        echo @sp:registry=https://artifactory.dimensiondata.com/artifactory/api/npm/npm/ >> ~/.npmrc
        echo //artifactory.dimensiondata.com/artifactory/api/npm/npm/:_auth=$ARTIFACTORY_AUTH >> ~/.npmrc
        echo //artifactory.dimensiondata.com/artifactory/api/npm/npm/:always-auth=true >> ~/.npmrc
        echo //artifactory.dimensiondata.com/artifactory/api/npm/npm/:email=$ARTIFACTORY_EMAIL >> ~/.npmrc
